import{_ as C,r as i,f as g,bD as T,o as J,g as h,Q as O,a as c,c as u,e as o,h as k,w as S,t as m,b as l,F as V,i as B,j as D,bE as H,ae as E,b6 as I,am as F}from"./index-953b23c6.js";import{u as U}from"./use-message-37081a3e.js";const $={class:"w-full p-2 h-full bg-cover bg-no-repeat",style:{"background-image":"url('/bg_deatied.png')"}},Q={class:"top"},W={style:{display:"flex",flex:"1","justify-content":"center","margin-right":"28px"}},q={class:"chat-area"},z={key:0,style:{display:"flex",margin:"10px 10px 15px 10px","justify-content":"flex-start","align-items":"center","flex-wrap":"nowrap"}},A=["src"],G={style:{display:"inline-block","max-width":"60%","word-break":"break-all","background-color":"greenyellow",padding:"15px","border-radius":"10px","margin-left":"20px"}},K={key:1,style:{display:"flex",margin:"10px 10px 15px 10px","justify-content":"flex-end","align-items":"center","flex-wrap":"nowrap"}},P={style:{display:"inline-block","max-width":"60%","word-break":"break-all","background-color":"greenyellow",padding:"15px","border-radius":"10px","margin-right":"20px"}},R=["src"],X={class:"footer"},Y={__name:"index",setup(Z){const t=JSON.parse(localStorage.getItem("orderMessage"));console.log("orderMessage",t);const j=U(),n=i();let r=g([]);const y=g({content:n,shop_id:t.shop_id,user_id:t.user_id,current_id:localStorage.getItem("id")}),p=localStorage.getItem("id");let d=new WebSocket("ws://124.222.246.206:3000");d.onopen=()=>{console.log("已连接到websocket服务器")};const L=()=>{n.value?(d.send(JSON.stringify(y)),h.post("/addChat",{content:n.value,shop_id:t.shop_id,user_id:t.user_id,current_id:localStorage.getItem("id"),token:localStorage.getItem("token")}).then(e=>{console.log("添加数据库",e.data)}),console.log("发送：",y),n.value=""):j.warning("请输入内容")};d.onmessage=e=>{console.log("接收:",JSON.parse(e.data));let s=g([]);s.value=JSON.parse(e.data),console.log("receiveList.value",s.value),r.value=r.value.concat(s.value),console.log("recordList",_),console.log("chatList",r.value)},d.onclose=()=>{console.log("连接已关闭")},T(()=>{d.onclose(()=>{console.log("离开页面，连接已关闭")})});const x=i(),v=i(),b=i();let _=g([]);const f=i(),N=()=>{h.post("/getChat",{shop_id:t.shop_id,user_id:t.user_id}).then(e=>{_.value=e.data.data,console.log("聊天记录",_.value),r.value=_.value})};return J(()=>{h.post("/getHead",{id:t.shop_id}).then(e=>{x.value=e.data.data.img_head}),h.post("/getHead",{id:t.user_id}).then(e=>{v.value=e.data.data.img_head,b.value=e.data.data.name}),N()}),O(()=>r.value,()=>{F(()=>{f.value.scrollTop=f.value.scrollHeight})},{deep:!0}),(e,s)=>{const w=E;return c(),u("div",$,[o("div",Q,[k(w,{onClick:s[0]||(s[0]=a=>e.$router.back())},{default:S(()=>[I("返回")]),_:1}),o("span",W,m(l(t).shop_id!==l(p)?l(t).shop_name:b.value),1)]),o("div",q,[o("div",{ref_key:"chat",ref:f,class:"overflow-hidden overflow-y-scroll area"},[(c(!0),u(V,null,B(l(r).value,(a,M)=>(c(),u("div",{key:M},[a.current_id!==l(p)?(c(),u("div",z,[o("img",{src:a.shop_id===l(p)?v.value:x.value,style:{display:"flex","flex-direction":"column","justify-content":"flex-start",width:"50px",height:"50px","border-radius":"25px","object-fit":"cover"}},null,8,A),o("span",G,m(a.content),1)])):(c(),u("div",K,[o("span",P,m(a.content),1),o("img",{src:a.user_id===l(p)?v.value:x.value,style:{display:"flex","flex-direction":"column","justify-content":"flex-start",width:"50px",height:"50px","border-radius":"25px","object-fit":"cover"}},null,8,R)]))]))),128))],512)]),o("div",X,[D(o("textarea",{"onUpdate:modelValue":s[1]||(s[1]=a=>n.value=a),class:"text",name:"",id:"",minlength:"1",maxlength:"200",placeholder:"请输入内容"},null,512),[[H,n.value]]),k(w,{onClick:L},{default:S(()=>[I("发送")]),_:1})])])}}},oe=C(Y,[["__scopeId","data-v-ce6d28fe"]]);export{oe as default};
