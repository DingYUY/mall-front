import{_ as U,u as M,r as p,f,o as y,a as B,c as E,e as c,h as t,w as s,g as _,ae as V,b6 as b,p as q,k as F}from"./index-953b23c6.js";import{u as L}from"./use-message-37081a3e.js";import{_ as T,a as $}from"./FormItem-2ba5ccbf.js";import{_ as j}from"./Input-e5c21a65.js";import"./Eye-53aa542d.js";import"./use-merged-state-b9c9e241.js";const z=d=>(q("data-v-83b9b0b0"),d=d(),F(),d),A={class:"user-setting"},R={class:"title"},D=z(()=>c("div",null,"用户设置",-1)),G={class:"pt-3"},H={class:"flex justify-center items-center"},J={__name:"index",setup(d){const m=L(),h=M(),w=p(null),e=f({name:"",password:"",studentId:"",studentName:"",idCard:"",isManager:""}),n=p(),I=()=>{_.post("/getCurrentUser",{_id:localStorage.getItem("id")}).then(a=>{console.log(a.data.data[0]),a.data.code===1&&a.data.data&&a.data.data[0]&&(n.value=a.data.data[0],console.log(n.value),console.log(e),e.name=n.value.name,e.password=n.value.password,e.studentId=n.value.studentId,e.studentName=n.value.studentName,e.idCard=n.value.idCard,e.isManager=n.value.isManager)})},v=p(),i=f([]),C=()=>{_.post("/getAllUser").then(a=>{a.data.code===1&&(console.log("allUser",a.data.data),v.value=a.data.data,v.value.map(o=>{i.push(o.name)}),console.log(i))})},k={name:{required:!0,validator(a,o){if(o){if(i.includes(o))return new Error("该昵称已存在")}else return new Error("请输入昵称")},trigger:["input","blur"]},password:{required:!0,message:"请输入密码",trigger:["input","blur"]}},x=()=>{_.post("/updateCurrentUser",{name:e.name,password:e.password}).then(a=>{console.log(a),m.success("提交成功，请重新登陆"),N()}).catch(a=>{m.error("提交失败")})},N=()=>{localStorage.removeItem("token"),localStorage.removeItem("name"),localStorage.removeItem("id"),localStorage.removeItem("head_img"),localStorage.removeItem("cart"),h.push("/login"),location.reload()};return y(()=>{I(),C()}),(a,o)=>{const g=V,l=j,r=$,S=T;return B(),E("div",A,[c("div",R,[D,t(g,{class:"back-button",onClick:o[0]||(o[0]=u=>a.$router.back())},{default:s(()=>[b("返回")]),_:1})]),c("div",G,[t(S,{ref_key:"userForm",ref:w,model:e,rules:k},{default:s(()=>[t(r,{path:"name",label:"昵称"},{default:s(()=>[t(l,{value:e.name,"onUpdate:value":o[1]||(o[1]=u=>e.name=u),placeholder:"请输入昵称",round:""},null,8,["value"])]),_:1}),t(r,{path:"password",label:"密码"},{default:s(()=>[t(l,{value:e.password,"onUpdate:value":o[2]||(o[2]=u=>e.password=u),placeholder:"请输入密码",type:"password",round:"","show-password-on":"mousedown"},null,8,["value"])]),_:1}),t(r,{path:"studentId",label:"学号"},{default:s(()=>[t(l,{value:e.studentId,placeholder:"无",disabled:"",round:""},null,8,["value"])]),_:1}),t(r,{path:"studentName",label:"姓名"},{default:s(()=>[t(l,{value:e.studentName,placeholder:"无",disabled:"",round:""},null,8,["value"])]),_:1}),t(r,{path:"idCard",label:"身份证号码"},{default:s(()=>[t(l,{value:e.idCard,placeholder:"无",disabled:"",round:""},null,8,["value"])]),_:1}),t(r,{path:"isManager",label:"权限范围"},{default:s(()=>[t(l,{value:e.isManager?"管理员":"普通员工",placeholder:"无",disabled:"",round:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),c("div",H,[t(g,{class:"mt-4",size:"large",onClick:x},{default:s(()=>[b("提交")]),_:1})])])}}},Y=U(J,[["__scopeId","data-v-83b9b0b0"]]);export{Y as default};
